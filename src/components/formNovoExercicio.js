import {
  Alert,
  KeyboardAvoidingView,
  Platform,
  ScrollView,
  Text,
  TextInput,
  TouchableOpacity,
  View,
} from 'react-native';
import React, { useContext, useState } from 'react';

import { ExerciciosContext } from '../contexts/exercicios';

export default function FormNovoExercicio() {
  const { criarExercicio } = useContext(ExerciciosContext);

  let niveis = [
    {
      nivel: 1,
      classificacao: 'Iniciante',
    },
    {
      nivel: 2,
      classificacao: 'Intermediário',
    },
    {
      nivel: 3,
      classificacao: 'Avançado',
    },
    {
      nivel: 4,
      classificacao: 'Profissional',
    },
  ];

  const [nomeExercicio, setNomeExercicio] = useState('');

  const [grupoMuscular, setGrupoMuscular] = useState('');

  const [nivel, setNivel] = useState(null);

  const [videoUrl, setVideoUrl] = useState('');

  // Salva o exercicio e envia para o banco de dados
  function salvandoExercicio() {
    // Verifica se os "campos" estão preenchidos
    if (!nomeExercicio || !grupoMuscular || !nivel || !videoUrl) {
      Alert.alert('Erro', 'Preencha corretamente os campos.');
      return;
    }

    // Cria-se um objeto para armazenar os dados
    let dados = {
      nome: nomeExercicio,
      grupoMuscular: grupoMuscular,
      nivel: nivel,
      videoUrl: videoUrl,
    };

    // Chama a função que cadastra no banco de dados o exercicio
    criarExercicio(dados);
    // Reseta os campos
    setGrupoMuscular('');
    setNomeExercicio('');
    setNivel('');
  }

  // <ScrollView className="flex-1"></ScrollView>
  return (
    <KeyboardAvoidingView
      className="flex-1"
      behavior={Platform.OS === 'ios' ? 'padding' : undefined}
    >
      <ScrollView
        contentContainerStyle={{ alignItems: 'center', marginTop: 20 }}
        showsVerticalScrollIndicator={false}
      >
        <View className="items-center w-full">
          <View className="w-4/5 h-full justify-end gap-6">
            <Text className="text-center text-lg">
              Criando um novo exercício
            </Text>
            {/* Definindo o nome do exercicio */}
            <View className="flex-row items-center w-full gap-2 ">
              <Text>Nome do exercicio: </Text>
              <TextInput
                placeholder="Ex: supino reto"
                placeholderTextColor={'#7a7b7d'}
                className="bg-white flex-1 elevation rounded p-2"
                maxLength={50}
                value={nomeExercicio}
                onChangeText={text => setNomeExercicio(text)}
              />
            </View>

            {/* Definindo o link auxiliar do exercicio */}
            <View className="flex-row items-center w-full gap-2 ">
              <Text>Video: </Text>
              <TextInput
                placeholder="Insira a url do vídeo"
                placeholderTextColor={'#7a7b7d'}
                className="bg-white flex-1 elevation rounded p-2"
                maxLength={50}
                value={videoUrl}
                onChangeText={text => setVideoUrl(text)}
              />
            </View>

            {/* Definindo grupo muscular */}
            <View className="flex-col  w-full gap-2">
              <Text>Selecione o grupo muscular: </Text>

              <View className="flex-row gap-4">
                <TouchableOpacity
                  onPress={() => setGrupoMuscular('Inferiores')}
                  className={`bg-white flex-1 items-center elevation rounded p-2 border-2 ${
                    grupoMuscular === 'Inferiores'
                      ? 'border-primary'
                      : 'border-white'
                  }`}
                >
                  <Text>Inferiroes</Text>
                </TouchableOpacity>

                <TouchableOpacity
                  onPress={() => setGrupoMuscular('Superiores')}
                  className={`bg-white flex-1 items-center elevation rounded p-2 border-2 ${
                    grupoMuscular === 'Superiores'
                      ? 'border-primary'
                      : 'border-white'
                  }`}
                >
                  <Text>Superiores</Text>
                </TouchableOpacity>

                <TouchableOpacity
                  onPress={() => setGrupoMuscular('Abdomen')}
                  className={`bg-white flex-1 items-center elevation rounded p-2 border-2 ${
                    grupoMuscular === 'Abdomen'
                      ? 'border-primary'
                      : 'border-white'
                  }`}
                >
                  <Text>Abdomen</Text>
                </TouchableOpacity>
              </View>
            </View>

            {/* Definindo nivel do exercicio */}
            <View className="flex-row justify-between">
              {niveis.map(item => {
                return (
                  <View key={item.nivel} className="items-center gap-1.5">
                    <TouchableOpacity
                      onPress={() => setNivel(item.classificacao)}
                      className={`bg-white items-center elevation rounded-lg px-6 py-4 border-2 ${
                        nivel === item.classificacao
                          ? 'border-primary'
                          : 'border-white'
                      }`}
                    >
                      <Text className="font-medium">{item.nivel}</Text>
                    </TouchableOpacity>

                    <Text>{item.classificacao}</Text>
                  </View>
                );
              })}
            </View>

            {/* Botão para salvar exercicio */}
            <View className="items-center">
              <TouchableOpacity
                onPress={salvandoExercicio}
                className="bg-primary items-center w-1/2 p-3.5 rounded-lg elevation"
              >
                <Text className="font-medium text-white">Salvar</Text>
              </TouchableOpacity>
            </View>
          </View>
        </View>
      </ScrollView>
    </KeyboardAvoidingView>
  );
}
